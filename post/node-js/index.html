<html>
      <head>
        <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,initial-scale=1,user-scalable=no" />
        <meta charset="utf-8">
        <meta name="referrer" content="never">
        <title>node js | 暗天使</title>
        <link rel="stylesheet" href="https://cdn.staticfile.org/KaTeX/0.11.1/katex.min.css">
        <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://warm-2233.github.io/styles/main.css">
          <script src="https://warm-2233.github.io/media/scripts/mdui.min.js"></script>
        <link rel="stylesheet" href="https://at.alicdn.com/t/font_1306644_jwtuc2zzbrd.css">
        <link href="https://fonts.googleapis.com/css?family=Dancing+Script|Ma+Shan+Zheng&display=swap" rel="stylesheet">
        <script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
        <script src="https://warm-2233.github.io/media/scripts/script.js"></script>
        <script >hljs.initHighlightingOnLoad();</script>
        

    </head>
    <body class="mdui-theme-primary-purple mdui-theme-accent-purple">
        <header class="index-img mdui-m-b-3"  style="background-image: url(https://warm-2233.github.io/post-images/node-js.jpg);" >
                          <button class="mdui-btn  mdui-btn-icon mdui-btn-dense mdui-color-theme-500 mdui-ripple yinying mdui-m-t-1 mdui-m-l-1" mdui-menu="{target: '#demo-attr-cascade'}">
                  <i class="mdui-icon material-icons"><svg fill="#fff" t="1617688782784" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2678" width="24" height="24"><path d="M170.666667 298.666667m-42.666667 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z" p-id="2679"></path><path d="M170.666667 512m-42.666667 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z" p-id="2680"></path><path d="M170.666667 725.333333m-42.666667 0a42.666667 42.666667 0 1 0 85.333333 0 42.666667 42.666667 0 1 0-85.333333 0Z" p-id="2681"></path><path d="M298.666667 469.333333m40.106666 0l517.12 0q40.106667 0 40.106667 40.106667l0 5.12q0 40.106667-40.106667 40.106667l-517.12 0q-40.106667 0-40.106666-40.106667l0-5.12q0-40.106667 40.106666-40.106667Z" p-id="2682"></path><path d="M298.666667 682.666667m40.106666 0l517.12 0q40.106667 0 40.106667 40.106666l0 5.12q0 40.106667-40.106667 40.106667l-517.12 0q-40.106667 0-40.106666-40.106667l0-5.12q0-40.106667 40.106666-40.106666Z" p-id="2683"></path><path d="M298.666667 256m40.106666 0l517.12 0q40.106667 0 40.106667 40.106667l0 5.12q0 40.106667-40.106667 40.106666l-517.12 0q-40.106667 0-40.106666-40.106666l0-5.12q0-40.106667 40.106666-40.106667Z" p-id="2684"></path></svg></i></button>
                <ul class="mdui-menu" id="demo-attr-cascade">
                
                        <li class="mdui-menu-item">
                          <a href="/" class="mdui-ripple">首页</a>
                        </li>
                
                        <li class="mdui-menu-item">
                          <a href="/archives" class="mdui-ripple">归档</a>
                        </li>
                
                        <li class="mdui-menu-item">
                          <a href="/tags" class="mdui-ripple">标签</a>
                        </li>
                
                        <li class="mdui-menu-item">
                          <a href="/post/about" class="mdui-ripple">关于</a>
                        </li>
                
                        <li class="mdui-menu-item">
                          <a href="/post/FriendLink" class="mdui-ripple">外链</a>
                        </li>
                
                      </ul>


        </header>
        <div class="mdui-container post">
                <div class="mdui-row">
                        <div class="mdui-col-md-8 mdui-col-offset-md-2 ">
                         <article class="mdui-shadow-10 mdui-p-a-2 post-list">
                           <div class="mdui-typo-display-1 mdui-m-b-3">node js</div>
                           <a  class="index-list-biaoqian ">2021-04-07</a>
                           <div class="mdui-typo mdui-m-t-3 post-neirong"><p><em>Node</em>.<em>js</em> 是一个基于 Chrome V8 引擎的 JavaScript 运行环境。即在服务器上也能使用 js 而不只是在游览器。</p>
<p><em>可以用</em> JavaScript 来写的应用,<em>最终都会</em>用 JavaScript 来写 。</p>
<!-- more -->
<p><a href="https://nodejs.org/">官网</a></p>
<p><a href="http://nodejs.cn/">中文网</a></p>
<h2 id="线程模型与事件循环">线程模型与事件循环</h2>
<h3 id="线程模型">线程模型</h3>
<p>线程模型服务器的处理模式就是重复三个步骤：</p>
<ol>
<li>创建线程接收用户请求</li>
<li>处理请求返回相应</li>
<li>断开连接，线程释放</li>
</ol>
<p>以上可看出每一个请求都会创建一个线程，完成后释放。如果有大量请求来时，服务器将会消耗较大的资源。</p>
<h3 id="事件循环">事件循环</h3>
<p>开一个事件等待循环<br>
请求来了。把请求放到<strong>队列</strong>里，继续等待请求。<br>
队列异步处理请求，处理完返回给客户端，结束这次请求。</p>
<h2 id="nodejs-控制台">nodeJs 控制台</h2>
<p>在终端输入 node 即可进入 nodejs 控制台。</p>
<figure data-type="image" tabindex="1"><img src="https://warm-2233.github.io/post-images/1617776935066.png" alt="" loading="lazy"></figure>
<p>在控制台可以输入执行 JavaScript 代码。</p>
<figure data-type="image" tabindex="2"><img src="https://warm-2233.github.io/post-images/1617776986410.png" alt="" loading="lazy"></figure>
<h2 id="阻塞-or-非阻塞">阻塞 or 非阻塞</h2>
<h3 id="阻塞">阻塞</h3>
<p>当遇到耗时操作或io时，程序将等待完成后才会继续向下执行</p>
<pre><code class="language-js">function a(){
    let start = new Date().getTime();
    while (new Date().getTime() &lt; start+3000) {/* 模拟耗时处理 */}
    console.log(&quot;函数 a 执行完毕&quot;);
}

a()
console.log(&quot;继续。。。&quot;);
</code></pre>
<h3 id="非阻塞">非阻塞</h3>
<p>将耗时操作放入队列中，程序就继续向下执行，待操作完成后执行回调函数。</p>
<pre><code class="language-js">function a(done){
    // 模拟耗时处理
    setTimeout(()=&gt;{
        done()
    }, 3000)
}

a(function(){
    console.log(&quot;函数 a 执行完毕&quot;);
})
console.log(&quot;继续。。。&quot;);
</code></pre>
<h2 id="node-web-服务器">node Web 服务器</h2>
<pre><code class="language-js">// 引入 http 官方包
const http = require('http');

const hostname = '127.0.0.1';
const port = 3000;

// 服务器实例
const server = http.createServer((req, res) =&gt; {
  res.statusCode = 200;	
  res.setHeader('Content-Type', 'text/plain');
  res.end('Hello World');
});

// 监听 主机 端口
server.listen(port, hostname, () =&gt; {
  console.log(`Server running at http://${hostname}:${port}/`);
});
</code></pre>
<h2 id="导出文件的设定">导出文件的设定</h2>
<p>在实际开发中会有许多的设置，将它们集合在一个文件中方便管理。</p>
<pre><code class="language-js">// __ server.js __

const http = require(&quot;http&quot;)

const conf = require(&quot;./conf&quot;).config

const server = http.createServer((req, res) =&gt; {
    res.statusCode = 200;
    res.setHeader('Content-Type', 'text/plain');
    res.end('Hello World');
  });
  
  server.listen(conf.port, conf.hostname, () =&gt; {
    console.log(`Server running at http://${conf.hostname}:${conf.port}/`);
  });
</code></pre>
<pre><code class="language-js">// __ conf.js __
const config = {
    hostname:'127.0.0.1',
    port: 3000,
}
module.exports.config = config
</code></pre>
<p>在 node 中使用 <code>module.exports</code> 来选择需要导出的资源，不像 js 得是全局变量。</p>
<p><code>module.exports</code> 在node 中是 <code>object</code> 对象，所以你可以这样：</p>
<pre><code class="language-js">// __ conf.js __
module.exports = config;
</code></pre>
<p>看在 <code>server.js</code> 会导入什么。</p>
<h2 id="url">url</h2>
<pre><code class="language-js">const http = require('http')
const hostname = '127.0.0.1'
const port = 3000

const server = http.createServer((req, res) =&gt; {
  res.statusCode = 200;
  res.setHeader('Content-Type', 'text/plain')
  ///////////////////////////////////////////////////
    switch (req.url){ // url 判断
    case &quot;/&quot;:
        res.end(&quot;hello nodejs&quot;)
        break
    case &quot;/home&quot;:
        res.end(&quot;home page&quot;)
        break
    default:
        res.statusCode = 404
        res.end(&quot;not found&quot;)
  }
});
	/////////////////////////////////////////////////

server.listen(port, hostname, () =&gt; {
  console.log(`Server running at http://${hostname}:${port}/`)
})
</code></pre>
<h2 id="html-读取">HTML 读取</h2>
<pre><code class="language-js">// -- server.js --
const http = require(&quot;http&quot;)
const fs = require(&quot;fs&quot;)

const server = http.createServer(function(req,res){
    fs.readFile(__dirname+&quot;/index.html&quot;, &quot;utf-8&quot;, function(err, data){
        if(err) {
            res.setHeader(&quot;Content-Type&quot;, &quot;text/plain&quot;)
            res.statusCode = 404
            console.log(err);
            res.end(&quot;path file err&quot;)
        }else{
            res.setHeader(&quot;Content-Type&quot;, &quot;text/html&quot;)
            res.statusCode = 200
            res.end(data)
        }
    })
})

server.listen(3000, &quot;127.0.0.1&quot;, ()=&gt;{
    console.log(&quot;http://127.0.0.1:3000&quot;);
})
</code></pre>
<pre><code class="language-html">&lt;!-- index.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;index&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;你好&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><code>fs</code>是 node 官方模块，<code> fs.readFile</code> 用于读取文件，接收3个参数</p>
<ul>
<li>路径</li>
<li>编码</li>
<li>回调函数
<ul>
<li>err 错误，正确读取文件返回<code>null</code></li>
<li>data 文件数据</li>
</ul>
</li>
</ul>
<h2 id="npm-包管理器">npm  包管理器</h2>
<p>在安装 nodeJs 将会自动安装 npm 在控制台输入<code>npm -v</code> 正确输出 npm 的版本号，即代表您的 noode 环境安装正确。</p>
<figure data-type="image" tabindex="3"><img src="https://warm-2233.github.io/post-images/1617777021217.png" alt="" loading="lazy"></figure>
<h3 id="常用命令">常用命令</h3>
<p><strong>安装</strong></p>
<pre><code class="language-bash">npm install [pkg]
</code></pre>
<p><strong>全局安装</strong></p>
<pre><code class="language-shell">npm install [pkg] -g
</code></pre>
<p><strong>使用镜像</strong></p>
<pre><code class="language-shell">npm install -g [pkg] --registry=https://registry.npm.taobao.org
</code></pre>
<p><strong>查看安装信息</strong></p>
<pre><code class="language-shell">npm list
npm list -g
</code></pre>
<h3 id="packagejson">package.json</h3>
<p>package.json 位于模块的目录下，用于定义包的属性。</p>
<p>更多请看 ==&gt; <a href="https://www.runoob.com/nodejs/nodejs-npm.html">菜鸟教程</a></p>
<h2 id="ejs-渲染网页">ejs 渲染网页</h2>
<p><strong>安装</strong></p>
<pre><code class="language-shell">npm install ejs
</code></pre>
<p><strong>常用方法</strong></p>
<pre><code class="language-js">// -- server.js --
const http = require(&quot;http&quot;)
const fs = require(&quot;fs&quot;)
const ejs = require(&quot;ejs&quot;)

let template = fs.readFileSync(__dirname+&quot;/template.ejs&quot;, &quot;utf-8&quot;)
const server = http.createServer(function(req,res){
    let data = ejs.render(template, {
        title: &quot;ejs template test&quot;,
    })

    res.setHeader(&quot;Content-Type&quot;, &quot;text/html&quot;)
    res.statusCode = 200
    res.end(data)
})

server.listen(3000, &quot;127.0.0.1&quot;, ()=&gt;{
    console.log(&quot;http://127.0.0.1:3000&quot;);
})
</code></pre>
<pre><code class="language-html">&lt;!-- template.ejs --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;ejs&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2 id="表单处理">表单处理</h2>
<pre><code class="language-js">const http = require(&quot;http&quot;)
const fs = require(&quot;fs&quot;)
const ejs = require(&quot;ejs&quot;)
const qs = require(&quot;querystring&quot;)

let template = fs.readFileSync(__dirname+&quot;/template.ejs&quot;, &quot;utf-8&quot;)
const server = http.createServer(function(req,res){
	// 判断请求方法
    if (req.method == &quot;POST&quot;){
        req.data = &quot;&quot;
        req.on(&quot;readable&quot;, function(){	// 读取请求内容
            let chr = req.read()
            if (chr){req.data += chr}
        })
        req.on(&quot;end&quot;, function(){	
            let query = qs.parse(req.data) // 解析
            let data = ejs.render(template, {	// 渲染
                title: &quot;ejs form &quot;,
                content: query.input
            })
            res.setHeader(&quot;Content-Type&quot;, &quot;text/html&quot;)
            res.statusCode = 200
            res.end(data)
        })
    }else{
        res.setHeader(&quot;Content-Type&quot;, &quot;text/html&quot;)
        res.statusCode = 200
        res.end(ejs.render(template,{
            title: &quot;ejs form &quot;,
            content: ''
        }))
    }
})

server.listen(3000, &quot;127.0.0.1&quot;, ()=&gt;{
    console.log(&quot;http://127.0.0.1:3000&quot;)
})
</code></pre>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;ejs&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;&lt;%= title %&gt;&lt;/h1&gt;
    &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;
        &lt;input type=&quot;text&quot; name=&quot;input&quot;&gt;
        &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;
    &lt;/form&gt;
    &lt;p&gt;&lt;%- content %&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>不然尝试优化一下代码，比如：将重复的代码整合成一个函数。</p>
<h2 id="回调地狱">回调地狱</h2>
<p>在node 中有许多的回调方法，在这些方法嵌套形成回调地狱，虽然对程序的执行结果没有影响，但其可读性极差，对于程序员来说这就是地狱。</p>
<hr>
<p>这这是我拙劣的见解，若有什么意见建议务必提出。</p>
<p><a href="https://www.bilibili.com/video/BV1Sp411f76q">观看视频</a><br>
我看以上视频写成这篇笔记，哇靠这是我连续几个小时完成的写到后面真的是澜礁疼，因为看指视频并不多，但还是高估自己了，可以看到这笔记越到后面越敷衍。</p>
<p>浪费了你人生中的几秒真的很抱歉（≧ ﹏ ≦）</p>
</div>
                              <div class="mdui-divider mdui-m-t-3"></div>
                              <div class="mdui-row-xs-2 mdui-m-t-2">
  <div class="mdui-col"> <div class="mdui-text-left"><a href="https://warm-2233.github.io/post/python-duo-jin-cheng/">python 多进程</a></div></div>
 <div class="mdui-col"></div>
                                </div>
                                <div class="mdui-divider mdui-m-t-2"></div>
   
 <script src="https://warm-2233.github.io/media/scripts/Valine.min.js"></script>
 <div class="comment"></div>

<script>
      new Valine({
            el: '.comment',



            path: window.location.pathname,
            pageSize: 30,
            avatar:'mm', 
       })

    </script> 
<script>
    if(window.location.hash){
        var checkExist = setInterval(function() {
           if ($(window.location.hash).length) {
              $('html, body').animate({scrollTop: $(window.location.hash).offset().top-90}, 1000);
              clearInterval(checkExist);
           }
        }, 100);
    }
</script>
                         </article>
                 <div class="toc-container mdui-float-right">
                   <style>.toc-container .markdownIt-TOC{display: none; top: 0px;}</style>
                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%E4%B8%8E%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF">线程模型与事件循环</a>
<ul>
<li><a href="#%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B">线程模型</a></li>
<li><a href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF">事件循环</a></li>
</ul>
</li>
<li><a href="#nodejs-%E6%8E%A7%E5%88%B6%E5%8F%B0">nodeJs 控制台</a></li>
<li><a href="#%E9%98%BB%E5%A1%9E-or-%E9%9D%9E%E9%98%BB%E5%A1%9E">阻塞 or 非阻塞</a>
<ul>
<li><a href="#%E9%98%BB%E5%A1%9E">阻塞</a></li>
<li><a href="#%E9%9D%9E%E9%98%BB%E5%A1%9E">非阻塞</a></li>
</ul>
</li>
<li><a href="#node-web-%E6%9C%8D%E5%8A%A1%E5%99%A8">node Web 服务器</a></li>
<li><a href="#%E5%AF%BC%E5%87%BA%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%BE%E5%AE%9A">导出文件的设定</a></li>
<li><a href="#url">url</a></li>
<li><a href="#html-%E8%AF%BB%E5%8F%96">HTML 读取</a></li>
<li><a href="#npm-%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8">npm  包管理器</a>
<ul>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">常用命令</a></li>
<li><a href="#packagejson">package.json</a></li>
</ul>
</li>
<li><a href="#ejs-%E6%B8%B2%E6%9F%93%E7%BD%91%E9%A1%B5">ejs 渲染网页</a></li>
<li><a href="#%E8%A1%A8%E5%8D%95%E5%A4%84%E7%90%86">表单处理</a></li>
<li><a href="#%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1">回调地狱</a></li>
</ul>
</li>
</ul>

                <script>
                     $(window).scroll(function() {
                      var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                      if (scrollTop > 350){ $(".markdownIt-TOC")[0].style.display = "block" }else{  $(".markdownIt-TOC")[0].style.display = "none" }})
                </script>
              </div>

                        </div>
                 </div>
          
        </div>
        <script data-no-instant>
    (function ($) {
        $.extend({
            adamsOverload: function () {
                $.viewImage({
                    'target'  : '.post-neirong img',
                    'exclude' : '.vsmile-icons img , .song-links-item img',
                    'delay'   : 300
                });
            }
        });
    })(jQuery);
    jQuery.adamsOverload();

    let e = document.getElementsByTagName("video")
                    for (let i=0; i<e.length; i++){
                      e[i].style.width = "100%"
                      e[i].controls = true
                    }
</script>
        <footer class="footer mdui-m-t-5 mdui-text-center">
               <nav class="social-links">
                      <ul>
                      
                            	
                        <li class="social-link"><a href="#" target="_blank"><i class="iconfont icon-rss"></i></a></li>
                         
                           
                            
                           
                            	
                        <li class="social-link"><a href="https://github.com/" target="_blank"><i class="iconfont icon-github"></i></a></li>
                         
                           
                            	
                        <li class="social-link"><a href="https://www.zhihu.com/" target="_blank"><i class="iconfont icon-zhihu"></i></a></li>
                         
                           
                            
                           
                            
                           
                            
                           
                            	
                        <li class="social-link"><a href="#" target="_blank"><i class="iconfont icon-douban"></i></a></li>
                         
                           
                            
                           
                            	
                        <li class="social-link"><a href="#" target="_blank"><i class="iconfont icon-qq"></i></a></li>
                         
                           
                            	
                        <li class="social-link"><a href="#" target="_blank"><i class="iconfont icon-weibo"></i></a></li>
                         
                           
                            	
                        <li class="social-link"><a href="https://www.bilibili.com/" target="_blank"><i class="iconfont icon-youtube"></i></a></li>
                         
                           
                      </ul>
                    </nav>
                  <div class="copyright">
                      <p><h4>邪王暗焰 の 博客</h4>
<p>莫要低估自己的能力，莫要高估自己的毅力</p>
静态博客由 <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> 构建，站点主题为 <a href="https://github.com/shanbufun/gridea-theme-jia" target="_blank">jia</a> 并在其基础上修改</p>
                  </div>
                  
              </footer>
    </body>
</html>